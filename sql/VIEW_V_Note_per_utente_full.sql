CREATE OR REPLACE VIEW `v_note_utente_full` AS select `n`.`IdContratto` AS `idcontratto`,`n`.`IdUtente` AS `idutente`,(case when ((`n`.`IdUtente` <> `n`.`IdCreatore`) and (sum(if((`nu`.`IdUtente` is not null),0,`n`.`NotaUtenteNonAut`)) > 0)) then sum(if((`nu`.`IdUtente` is not null),0,`n`.`NotaUtenteNonAut`)) else -(sum(`n`.`NotaUtenteNonAut`)) end) AS `NumNoteUtenteNonAut`,(case when ((`n`.`IdUtente` <> `n`.`IdCreatore`) and (sum(if((`nu`.`IdUtente` is not null),0,`n`.`NotaUtenteAut`)) > 0)) then sum(if((`nu`.`IdUtente` is not null),0,`n`.`NotaUtenteAut`)) else -(sum(`n`.`NotaUtenteAut`)) end) AS `NumNoteUtenteAut`,(case when ((`n`.`IdUtente` <> `n`.`IdCreatore`) and (sum(if((`nu`.`IdUtente` is not null),0,`n`.`NotaRepartoNonAut`)) > 0)) then sum(if((`nu`.`IdUtente` is not null),0,`n`.`NotaRepartoNonAut`)) else -(sum(`n`.`NotaRepartoNonAut`)) end) AS `NumNoteRepartoNonAut`,(case when ((`n`.`IdUtente` <> `n`.`IdCreatore`) and (sum(if((`nu`.`IdUtente` is not null),0,`n`.`NotaRepartoAut`)) > 0)) then sum(if((`nu`.`IdUtente` is not null),0,`n`.`NotaRepartoAut`)) else -(sum(`n`.`NotaRepartoAut`)) end) AS `NumNoteRepartoAut`,(case when ((`n`.`IdUtente` <> `n`.`IdCreatore`) and (sum(if((`nu`.`IdUtente` is not null),0,`n`.`NotaSuper`)) > 0)) then sum(if((`nu`.`IdUtente` is not null),0,`n`.`NotaSuper`)) else -(sum(`n`.`NotaSuper`)) end) AS `NumNoteSuper` from ((`v_note_utente_plus` `n` join `utente` `ut` on((`n`.`IdUtente` = `ut`.`IdUtente`))) left join `notautente` `nu` on(((`ut`.`IdReparto` = `nu`.`IdReparto`) and (`n`.`IdNota` = `nu`.`IdNota`)))) group by `n`.`IdContratto`,`n`.`IdUtente`;
